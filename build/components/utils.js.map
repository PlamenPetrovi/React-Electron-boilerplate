{"version":3,"sources":["../../app/components/utils.js"],"names":["Utils","defaultConfig","path","join","__dirname","ownConfig","config_path","fs","existsSync","defaultContentDirectory","webappSymlink","maxImages","getConfig","checkGrayscaleMode","getContentDirectory","initializeBranding","loadRecentImagesAfterStart","printIpAddresses","force","config","require","new_config","callback","self","writeFile","err","console","error","_path","resolve","cache","log","contentDir","undefined","newContentDir","content_dir","length","String","mkdirSync","startsWith","getPhotosDirectory","getWebAppPhotosDirectory","photosDir","photoDir","webappSymlinkInitialized","unlinkSync","symlinkSync","photos_dir","readdir","files","sort","numberImages","i","endsWith","prependImage","img","attr","div","append","prepend","branding","type","html","content","position","css","now","Date","secs","getSeconds","mins","getMinutes","hours","getHours","date","getDate","month","getMonth","year","getFullYear","ifaces","os","networkInterfaces","forEach","ifname","alias","iface","family","internal","address","init","grayscaleMode","filename","grayscale","newFilename","replace","tmpDir","convertedFilepath","webappFilepath","cb","setInterval","utils","default"],"mappings":"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","file":"utils.js","sourcesContent":["/* \r\n * This file is part of \"photo-booth\" \r\n * Copyright (c) 2018 Philipp Trenz\r\n *\r\n * For more information on the project go to\r\n * <https://github.com/philipptrenz/photo-booth>\r\n * \r\n * This program is free software: you can redistribute it and/or modify  \r\n * it under the terms of the GNU General Public License as published by  \r\n * the Free Software Foundation, version 3.\r\n *\r\n * This program is distributed in the hope that it will be useful, but \r\n * WITHOUT ANY WARRANTY; without even the implied warranty of \r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU \r\n * General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License \r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\nimport os from 'os';\r\nimport fs from 'fs';\r\nimport $ from 'jquery';\r\nimport path from 'path';\r\n//import sharp from 'sharp';\r\n\r\n\r\nclass Utils {\r\n\r\n  constructor() {\r\n\r\n    var defaultConfig = path.join(__dirname, '../', './config.json');\r\n    var ownConfig = path.join(__dirname, '../', './my.config.json');\r\n    this.config_path = fs.existsSync(ownConfig) ? ownConfig : defaultConfig;\r\n\r\n    this.defaultContentDirectory = path.join(__dirname, '../', '/content');\r\n    this.webappSymlink = path.join(__dirname, \"../\", \"./webapp/photos\");\r\n\r\n    this.maxImages = 20;\r\n\r\n    this.getConfig();\r\n    this.checkGrayscaleMode();\r\n    this.getContentDirectory();\r\n\r\n    this.initializeBranding();\r\n    this.loadRecentImagesAfterStart();\r\n    this.printIpAddresses();\r\n  }\r\n\r\n  getConfig(force = false) {\r\n    if (!this.config || force) {   \r\n      this.config = require(this.config_path);\r\n      return this.config;\r\n    }\r\n    return this.config;\r\n  }\r\n\r\n  saveConfig(new_config, callback) {\r\n\r\n    // TODO: Add json-schema validation for config.json\r\n\r\n    if (!new_config) {\r\n      callback(false);\r\n      return;\r\n    }\r\n\r\n    var self = this;\r\n    fs.writeFile(this.config_path, JSON.stringify(new_config, null, \"\\t\"), function (err) {\r\n      if (err) {\r\n        console.error('utils: updating config.json failed', err);\r\n        callback(false, err);\r\n      } else {\r\n        // force config.json to be reloaded\r\n        const _path = require.resolve(self.config_path);\r\n        delete require.cache[_path];\r\n\r\n        self.config = require(self.config_path); // should not be needed\r\n        //console.log('utils: config.json updated: \\n'+JSON.stringify(self.config, null, \"\\t\"));\r\n        console.log('utils: config.json updated');\r\n        callback(true);\r\n      }\r\n    });\r\n  }\r\n\r\n  getContentDirectory() {\r\n    if (this.contentDir === undefined) {\r\n      var newContentDir = this.config.content_dir;\r\n      if ( newContentDir !== null && typeof newContentDir === 'string' && newContentDir.length > 0) {  // if valid path in config\r\n        try {\r\n          if (!fs.existsSync(String(newContentDir))) fs.mkdirSync(String(newContentDir));\r\n          this.contentDir = (newContentDir.startsWith('/')) ? newContentDir : path.join(__dirname, '../', newContentDir ); \r\n        } catch (err) {\r\n          // fallback: default\r\n          console.error('Could not open or create content_dir \\''+this.config.content_dir+'\\' like defined in config.json. '+err+'\\nInstead going to use default \\'',this.defaultContentDirectory,'\\'');\r\n          if (!fs.existsSync(this.defaultContentDirectory)) fs.mkdirSync(this.defaultContentDirectory);\r\n          this.contentDir = this.defaultContentDirectory;\r\n        }\r\n      } else {\r\n        // fallback: default\r\n        if (!fs.existsSync(this.defaultContentDirectory)) fs.mkdirSync(this.defaultContentDirectory);\r\n        this.contentDir = this.defaultContentDirectory;\r\n      }\r\n    }\r\n\r\n    // initalized the depending directories\r\n    this.getPhotosDirectory();\r\n    this.getWebAppPhotosDirectory();\r\n\r\n    return this.contentDir;\r\n  }\r\n\r\n  getPhotosDirectory() {\r\n    if (this.photosDir === undefined) {\r\n      const photoDir = path.join(this.contentDir, \"photos/\");\r\n      if (!fs.existsSync(photoDir)) fs.mkdirSync(photoDir);\r\n      this.photosDir = photoDir;\r\n      return this.photosDir;\r\n    }\r\n    return this.photosDir;\r\n  }\r\n\r\n  getWebAppPhotosDirectory() {\r\n    if (this.webappSymlinkInitialized === undefined || !this.webappSymlinkInitialized) {\r\n      if (fs.existsSync(this.webappSymlink)) {\r\n        try {\r\n          fs.unlinkSync(this.webappSymlink);\r\n        } catch (err) {\r\n          console.error('utils: could not remove old symlink, probably a problem with access rights', err);\r\n        }\r\n      }\r\n      fs.symlinkSync(this.photosDir, this.webappSymlink);\r\n      this.webappSymlinkInitialized = true;\r\n    }\r\n    return 'photos/';\r\n  }\r\n\r\n  // ---------------------------------------------------- //\r\n\r\n  loadRecentImagesAfterStart() {\r\n\r\n    var photos_dir = this.getPhotosDirectory();\r\n    var self = this;\r\n    fs.readdir(photos_dir, function(err, files){\r\n\r\n      if (files) {\r\n        files.sort();\r\n        var numberImages = (files.length < self.maxImages) ? files.length : self.maxImages;\r\n        for (var i = 0; i < numberImages; i++) {\r\n          //console.log(photos_dir+\"/\"+files[i]);\r\n          // just take jpegs\r\n          if ( files[i].endsWith(\".jpg\") || files[i].endsWith(\".jpeg\") || files[i].endsWith(\".JPG\") || files[i].endsWith(\".JPEG\") ){  \r\n            self.prependImage(self.getPhotosDirectory()+\"/\"+files[i]);\r\n          }\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  prependImage(path) {\r\n    var img = $('<img>');\r\n    img.attr('src', path);\r\n    var div = $('<div class=\"img-wrapper col-6 col-md-4\">').append(img);\r\n    $(\"#collage\").prepend(div);\r\n  }\r\n\r\n  // ---------------------------------------------------- //\r\n\r\n  initializeBranding() {\r\n    if (this.config.branding) {\r\n\r\n      var type = this.config.branding.type\r\n      if (type) {\r\n        if (type == 'text') {\r\n          $('#front').html(this.config.branding.content);\r\n        } else if (type == 'image') {\r\n          $('#front').html(\"Not yet implemented\");\r\n        }\r\n      }\r\n      \r\n\r\n      var position = this.config.branding.position\r\n      if (position) {\r\n        if (position == 'center') {\r\n          $('#front').css('align-items','center');\r\n          $('#front').css('justify-content','center');\r\n        } else if (position == 'topleft') {\r\n          $('#front').css('align-items','flex-start');\r\n          $('#front').css('justify-content','flex-start');\r\n        } else if (position == 'topright') {\r\n          $('#front').css('align-items','flex-start');\r\n          $('#front').css('justify-content','flex-end');\r\n        } else if (position == 'bottomleft') {\r\n          $('#front').css('align-items','flex-end');\r\n          $('#front').css('justify-content','flex-start');\r\n        } else if (position == 'bottomright') {\r\n          $('#front').css('align-items','flex-end');\r\n          $('#front').css('justify-content','flex-end');\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  getTimestamp(now = new Date()) {\r\n    var secs = now.getSeconds() < 10 ? '0'+now.getSeconds() : now.getSeconds();\r\n    var mins = now.getMinutes() < 10 ? '0'+now.getMinutes() : now.getMinutes();\r\n    var hours = now.getHours() < 10 ? '0'+now.getHours() : now.getHours();\r\n    var date = now.getDate() < 10 ? '0'+String(now.getDate()) : String(now.getDate());\r\n    var month = (now.getMonth()+1) < 10 ? '0'+String(now.getMonth()+1) : String(now.getMonth()+1);\r\n    var year = String(now.getFullYear());\r\n\r\n    return year+month+date+'_'+hours+'-'+mins+'-'+secs;\r\n  }\r\n\r\n  getDate(now) {\r\n    return now.getFullYear()+'-'+(now.getMonth()+1)+'-'+now.getDate();\r\n  }\r\n\r\n  printIpAddresses() {\r\n    var ifaces = os.networkInterfaces();\r\n\r\n    Object.keys(ifaces).forEach(function (ifname) {\r\n      var alias = 0;\r\n\r\n      ifaces[ifname].forEach(function (iface) {\r\n        if ('IPv4' !== iface.family || iface.internal !== false) {\r\n          // skip over internal (i.e. 127.0.0.1) and non-ipv4 addresses\r\n          return;\r\n        }\r\n\r\n        if (alias >= 1) {\r\n          // this single interface has multiple ipv4 addresses\r\n          console.log(\"utils: interface\", ifname + ':' + alias, iface.address);\r\n        } else {\r\n          // this interface has only one ipv4 adress\r\n          console.log(\"utils: interface\", ifname, iface.address);\r\n        }\r\n        ++alias;\r\n      });\r\n    });\r\n  }\r\n\r\n  checkGrayscaleMode() {\r\n    if (this.getConfig().init.grayscaleMode) {\r\n      console.log(\"utils: using grayscale mode\");\r\n      $('head').append('<link rel=\"stylesheet\" type=\"text/css\" href=\"css/grayscale.css\">');\r\n    }\r\n  }\r\n\r\n  convertImageForDownload(filename, grayscale, callback) {\r\n\r\n    var self = this;\r\n    var _path = path.join(this.photosDir, filename);\r\n    var newFilename = 'photo-booth_'+filename.replace('img_', '');\r\n    var tmpDir = path.join(this.getPhotosDirectory(), './tmp');\r\n    var convertedFilepath = path.join(this.getPhotosDirectory(), './tmp', newFilename);\r\n    var webappFilepath = path.join(this.getWebAppPhotosDirectory(), 'tmp', newFilename);\r\n\r\n    if (!fs.existsSync(tmpDir)) fs.mkdirSync(tmpDir);\r\n\r\n    function cb(err) {\r\n      if (err) {\r\n        callback(false, 'resizing image failed', err)\r\n      } else {\r\n        callback(true, webappFilepath);\r\n      }\r\n      // delete file after 10s\r\n      setInterval(function(){\r\n        if (fs.existsSync(convertedFilepath)) fs.unlinkSync(convertedFilepath);\r\n      },10000);\r\n    }\r\n\r\n    // if (grayscale) {\r\n    //   sharp(_path) // resize image to given maxSize\r\n    //     .grayscale()\r\n    //     .resize(self.config.webapp.maxDownloadImageSize)  // Scale down images on webapp\r\n    //     .toFile(convertedFilepath, cb);\r\n    // } else {\r\n    //   sharp(_path) // resize image to given maxSize\r\n    //     .resize(self.config.webapp.maxDownloadImageSize)  // Scale down images on webapp\r\n    //     .toFile(convertedFilepath, cb);\r\n    // }\r\n  }\r\n\r\n}\r\n\r\n/*\r\n * Module exports for connection\r\n */\r\n let utils = new Utils() \r\nexport { utils as default };"]}