{"version":3,"sources":["../../app/components/booth.js"],"names":["camera","initialize","res","msg","err","console","error","CameraErrorOnStartupPrompt","start","click","trigger","utils","getConfig","init","useGPIO","undefined","log","gpio","require","setMode","MODE_BCM","setup","DIR_IN","EDGE_BOTH","on","channel","value","countdownLength","executing","slideshow","stop","isInitialized","triggerPhotoOffsetBeforeZero","prompt","CountdownPrompt","SpinnerPrompt","setTimeout","takePicture","msg1","msg2","message1","message2","previewDuration","PreviewPrompt","prependImage","webApp","sendNewPhoto","CameraErrorPrompt","SharpErrorPrompt","module","exports","triggerPhoto"],"mappings":"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","file":"booth.js","sourcesContent":["/* \n * This file is part of \"photo-booth\" \n * Copyright (c) 2018 Philipp Trenz\n *\n * For more information on the project go to\n * <https://github.com/philipptrenz/photo-booth>\n * \n * This program is free software: you can redistribute it and/or modify  \n * it under the terms of the GNU General Public License as published by  \n * the Free Software Foundation, version 3.\n *\n * This program is distributed in the hope that it will be useful, but \n * WITHOUT ANY WARRANTY; without even the implied warranty of \n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU \n * General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License \n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n */\n\n//'use strict';\nimport 'util';\n\nimport $ from 'jquery';\n\n//import 'popper.js';\n//import 'bootstrap';\n\nimport utils from \"./utils.js\";\nimport camera from \"./camera.js\";\nimport { \n  SpinnerPrompt, \n  CountdownPrompt, \n  PreviewPrompt, \n  CameraErrorPrompt, \n  CameraErrorOnStartupPrompt, \n  SharpErrorPrompt\n} from \"./prompt.js\";\nimport slideshow from \"./slideshow.js\";\n\nimport webApp from './webapp_server.js';\n\ncamera.initialize(function( res, msg, err) {\n  if (!res) {\n    console.error('camera:', msg, err);\n\n    new CameraErrorOnStartupPrompt(-1).start(false, false);\n\n  }\n});\n\n\n/*\n * Trigger photo when clicking / touching anywhere at the screen\n */\n$( \"body\" ).click(function() {\n  trigger();\n});\n\n\n/* Listen for pushbutton on GPIO 3 (PIN 5)\n * Activate the use of GPIOs by setting useGPIO in config.json to true.\n */\nif (utils.getConfig().init.useGPIO !== undefined ? utils.getConfig().init.useGPIO : true) {\n  console.log('GPIO usage activated');\n  var gpio = require('rpi-gpio');\n  gpio.setMode(gpio.MODE_BCM);\n  gpio.setup(3, gpio.DIR_IN, gpio.EDGE_BOTH);\n  gpio.on('change', function(channel, value) {\n    if (channel == 3 && !value) trigger();\n    // NOTE: takePhoto() is secure to don't run twice \n    // at the same time, make sure this is also so for\n    // your code.\n  });\n}\n\nconst countdownLength = (typeof utils.getConfig().countdownLength == 'number') ? utils.getConfig().countdownLength : 5;\n\nvar executing = false;\nfunction trigger() {\n\n  if (executing) return;\n\n  executing = true;\n\n  slideshow.stop();\n\n  if (camera.isInitialized()) {\n\n    var triggerPhotoOffsetBeforeZero = 0.5; // in seconds\n\n    // start countdown and show spinner afterwards\n    var prompt = new CountdownPrompt(countdownLength).start( true, false, function() {\n      prompt = new SpinnerPrompt();\n      // wait a sec for spinner to start\n      setTimeout(function() {\n        prompt.start(true, false);\n      }, 1500);\n    });\n\n    // take picture after countdown\n    setTimeout(function() {\n\n      camera.takePicture(function(res, msg1, msg2) {\n\n        const message1 = msg1;\n        const message2 = msg2\n\n        prompt.stop(true, false, function() { // stop spinner if image is ready\n\n            if (res == 0) {\n              const previewDuration = 8;\n              // after that show preview\n              prompt = new PreviewPrompt(message1, previewDuration).start(false, false, function() {\n                // end photo task after preview ended\n                executing = false;\n              });\n\n              setTimeout(function() {\n                utils.prependImage(message1);     // add image to collage\n              }, 1500);\n\n              webApp.sendNewPhoto(message2);  // send image to connected web clients\n\n\n              slideshow.start();\n\n            } else {\n\n              console.error(message1, '\\n', message2);\n\n              if (res == -1 ) {  // camera not initialized\n                new CameraErrorPrompt(5).start(false, false, function() { executing = false; });\n              } else if (res == -2) { // gphoto2 error\n                new CameraErrorPrompt(5).start(false, false, function() { executing = false; });\n              } else if (res == -3) { // sharp error\n                 new SharpErrorPrompt(5).start(false, false, function() { executing = false; });\n              }\n            }\n\n        });\n\n      });\n\n    }, (countdownLength-triggerPhotoOffsetBeforeZero)*1000);\n\n  } else {\n\n    // TODO: Handle uninitialized camera\n\n    camera.initialize(function( res, msg, err) {\n      if (res) {\n\n        executing = false;\n        trigger();\n\n      } else {\n\n        // TODO: handle error\n        new CameraErrorPrompt(5).start(false, false, function() {\n          executing = false;\n        })\n\n      }\n\n    });\n\n  }\n  \n}\n\n/*\n * Module exports\n */\nmodule.exports.triggerPhoto = trigger;"]}